#
# Copyright 2024 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

quick-start-app-config:
  # 设备可以访问的IP或域名(1078 码流将上传到这个地址)
  jt1078-server-host: 192.168.71.5

jt1078-server:
  enabled: true
  features:
    request-combiner:
      enabled: true
      sub-package-storage:
        maximum-size: 1024
        ttl: 60s
    dashboard:
      enabled: true
      redirect-root-to-base-path: true
      forward-not-found-to-index: true
      jt808-dashboard-proxy:
        base-url: http://localhost:8888
      # FIXME 为方便调试 这里允许播放地址跨域访问
      dashboard-api-cors-filter:
        enabled: true
        path-pattern: /dashboard-api/jt1078/v1/stream-data/**
        allow-credentials: false
        allowed-origins: '*'
        allowed-origin-patterns: [ ]
        allowed-headers: '*'
        exposed-headers: [ ]
        allowed-methods: '*'
        max-age: null
  tcp-server:
    enabled: true
    host: 0.0.0.0
    port: 7856
    max-frame-length: 8192
    session-idle-state-checker:
      writer-idle-time: 0s
      reader-idle-time: 0s
      all-idle-time: 10m
    loop-resources:
      thread-name-prefix: x78-tcp
      daemon: true
      prefer-native: true
      colocate: true
  udp-server:
    enabled: true
    host: 0.0.0.0
    port: 7963
    session-idle-state-checker:
      max-idle-time: 10m
      check-interval: 10s
      check-backoff-time: 10s
    loop-resources:
      thread-name-prefix: x78-udp
      daemon: true
      prefer-native: true
      colocate: true
  # 音视频流配置
  audio-video-stream:
    # 音视频流 编解码配置
    codec:
      scheduler:
        type: bounded_elastic
        # 当且仅当 jt1078-server.audio-video-stream.codec.scheduler.type == bounded_elastic 时生效
        bounded-elastic:
          daemon: true
          thread-name-prefix: x78-codec-elastic
          ## @default reactor.core.scheduler.Schedulers.DEFAULT_BOUNDED_ELASTIC_SIZE
          thread-capacity: 32
          ## @default reactor.core.scheduler.Schedulers.DEFAULT_BOUNDED_ELASTIC_QUEUESIZE
          queued-task-capacity: 2048
          reject-blocking-task: true
        # 当且仅当 jt1078-server.audio-video-stream.codec.scheduler.type == parallel 时生效
        parallel:
          daemon: true
          thread-name-prefix: x78-codec-parallel
          reject-blocking-task: true
          ## @default reactor.core.scheduler.Schedulers.DEFAULT_POOL_SIZE + 2
          parallelism: 10
        # 当且仅当 jt1078-server.audio-video-stream.codec.scheduler.type == virtual 时生效
        virtual:
          prefix: x78-codec-vt
        # 当且仅当 jt1078-server.audio-video-stream.codec.scheduler.type == single 时生效
        ## !!!仅仅用于测试!!!
        single:
          daemon: true
          thread-name-prefix: x78-codec-single
          reject-blocking-task: false
    # 音视频流 订阅者配置
    subscriber:
      scheduler:
        metrics:
          enabled: false
          prefix: x78-subscriber
        type: bounded_elastic
        # 当且仅当 jt1078-server.audio-video-stream.subscriber.scheduler.type == bounded_elastic 时生效
        bounded-elastic:
          daemon: true
          thread-name-prefix: x78-subscriber-elastic
          ## @default reactor.core.scheduler.Schedulers.DEFAULT_BOUNDED_ELASTIC_SIZE
          thread-capacity: 32
          ## @default reactor.core.scheduler.Schedulers.DEFAULT_BOUNDED_ELASTIC_QUEUESIZE
          queued-task-capacity: 2048
          reject-blocking-task: true
        # 当且仅当 jt1078-server.audio-video-stream.subscriber.scheduler.type == parallel 时生效
        parallel:
          daemon: true
          thread-name-prefix: x78-subscriber-parallel
          reject-blocking-task: true
          ## @default reactor.core.scheduler.Schedulers.DEFAULT_POOL_SIZE + 2
          parallelism: 10
        # 当且仅当 jt1078-server.audio-video-stream.subscriber.scheduler.type == virtual 时生效
        virtual:
          prefix: x78-subscriber-vt
        # 当且仅当 jt1078-server.audio-video-stream.subscriber.scheduler.type == single 时生效
        ## !!!仅仅用于测试!!!
        single:
          daemon: true
          thread-name-prefix: x78-subscriber-single
          reject-blocking-task: false

logging:
  level:
    root: info
    io.netty.handler.logging.LoggingHandler: debug
